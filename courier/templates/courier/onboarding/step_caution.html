{% extends "courier/onboarding/base.html" %}

{% block step_content %}
<div class="onboarding-card">
    <h2 class="card-title">üí∞ Caution S√©curit√©</h2>
    <p class="card-subtitle">D√©p√¥t de garantie remboursable √† la fin de votre collaboration</p>

    <div class="caution-amount">
        <div class="caution-value">{{ onboarding.caution_amount|floatformat:0 }} XAF</div>
        <div class="caution-label">Montant de la caution</div>
    </div>

    <div class="alert info">
        <strong>Pourquoi une caution ?</strong>
        <ul style="margin: 0.5rem 0 0 1rem; padding: 0;">
            <li>Garantir votre engagement s√©rieux</li>
            <li>Couvrir d'√©ventuels incidents</li>
            <li>100% remboursable √† la fin de votre collaboration</li>
        </ul>
    </div>

    {% if not onboarding.caution_paid %}
    <form method="post" action="{% url 'courier:onboarding-caution' %}">
        {% csrf_token %}

        <div class="form-group">
            <label>M√©thode de paiement</label>
            <select name="payment_method" required>
                <option value="">S√©lectionnez...</option>
                <option value="MTN_MOMO">üì± MTN Mobile Money</option>
                <option value="ORANGE_MONEY">üì± Orange Money</option>
                <option value="CASH">üíµ Esp√®ces (en agence)</option>
            </select>
        </div>

        <div id="momoInstructions" style="display: none;">
            <div class="alert warning">
                <strong>Instructions Mobile Money:</strong>
                <ol style="margin: 0.5rem 0 0 1rem; padding: 0;">
                    <li>Envoyez <strong>{{ onboarding.caution_amount|floatformat:0 }} XAF</strong> au <strong>+237 6XX
                            XXX XXX</strong></li>
                    <li>Motif: "Caution DELIVR {{ user.phone_number|slice:"-4:" }}"</li>
                    <li>Entrez l'ID de transaction ci-dessous</li>
                </ol>
            </div>

            <div class="form-group">
                <label>ID Transaction Mobile Money *</label>
                <input type="text" name="transaction_id" placeholder="Ex: 123456789ABC">
            </div>
        </div>

        <div id="cashInstructions" style="display: none;">
            <div class="alert warning">
                <strong>Paiement en agence:</strong>
                <p>Pr√©sentez-vous √† notre agence avec votre pi√®ce d'identit√©.</p>
                <p>üìç <strong>Douala:</strong> Akwa Nord, face station Total</p>
                <p>üìç <strong>Yaound√©:</strong> Bastos, rue principale</p>
            </div>

            <div class="form-group">
                <label>Num√©ro de re√ßu (si d√©j√† pay√©)</label>
                <input type="text" name="transaction_id" placeholder="Num√©ro sur votre re√ßu">
            </div>
        </div>

        <button type="submit" class="btn-primary" id="payBtn">
            Confirmer le paiement
        </button>
    </form>

    <script>
        document.querySelector('[name="payment_method"]').addEventListener('change', function () {
            document.getElementById('momoInstructions').style.display =
                (this.value === 'MTN_MOMO' || this.value === 'ORANGE_MONEY') ? 'block' : 'none';
            document.getElementById('cashInstructions').style.display =
                this.value === 'CASH' ? 'block' : 'none';
        });
    </script>
    {% else %}
    <div class="alert success">
        ‚úÖ Caution de {{ onboarding.caution_amount|floatformat:0 }} XAF pay√©e le {{
        onboarding.caution_paid_at|date:"d/m/Y" }}
        <br>
        <small>Transaction: {{ onboarding.caution_transaction_id }}</small>
    </div>

    <a href="{% url 'courier:onboarding-contract' %}" class="btn-primary"
        style="display: block; text-align: center; text-decoration: none;">
        Continuer ‚Üí
    </a>
    {% endif %}
</div>
{% endblock %}